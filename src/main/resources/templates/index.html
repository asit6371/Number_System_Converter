<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number System Converter</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom gradient for the button */
        .gradient-button {
            background: linear-gradient(90deg, #ff9944, #ff5566);
            transition: all 0.2s;
        }
        .gradient-button:hover {
            opacity: 0.9;
            box-shadow: 0 4px 15px rgba(255, 85, 102, 0.4);
        }
        /* Custom background gradient to match the image's aesthetic */
        body {
            background-color: #f0f4f8; /* Light background */
            font-family: 'Inter', sans-serif;
        }

        /* Subtle glow for the floating accent in the corner */
        .accent-glow {
            background: linear-gradient(135deg, #f55, #f99, #f77);
            box-shadow: 0 0 10px rgba(255, 130, 130, 0.8);
        }

        /* Styling to remove default arrow on select for a cleaner look */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236B7280'%3E%3Cpath fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem; /* Make space for the icon */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }

        // --- Gemini API Utilities ---
        const apiKey = "AIzaSyBsZkEBL0DQOm9crUr5pdGx-RujwL4qYOM";
        const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent";

        // IMPORTANT DEBUGGING NOTE: Check if running on file:// protocol, which causes CORS errors.
        if (window.location.protocol === 'file:') {
            console.error("CORS ERROR WARNING: You are running this file directly from your local filesystem (file:// protocol).");
            console.error("The Gemini API calls will likely be blocked by your browser's security policies (CORS).");
            console.error("SOLUTION: Please run a simple local HTTP server (like VS Code's Live Server or Python's SimpleHTTPServer) to view this app correctly.");
        }


        /**
         * Handles the main conversion logic using explicit "From" and "To" bases.
         */
        function convertNumber() {
            const numberInput = document.getElementById('numberInput');
            const fromBaseSelect = document.getElementById('fromBase');
            const targetBaseSelect = document.getElementById('targetBase');
            const resultInput = document.getElementById('resultInput');

            // New LLM elements
            const explainButton = document.getElementById('explainButton');
            const llmContainer = document.getElementById('llmResultContainer');

            // Reset LLM state
            explainButton.classList.add('hidden');
            llmContainer.classList.add('hidden');

            const rawInput = numberInput.value.trim();

            // Clean input by removing common prefixes (0x, 0b, 0o)
            let cleanInput = rawInput.toLowerCase();
            if (cleanInput.startsWith('0x') || cleanInput.startsWith('0b') || cleanInput.startsWith('0o')) {
                cleanInput = cleanInput.substring(2);
            }

            const sourceRadix = parseInt(fromBaseSelect.value);
            const targetRadix = parseInt(targetBaseSelect.value);

            if (cleanInput.length === 0) {
                resultInput.value = 'Please enter a number.';
                return;
            }

            try {
                // 1. Convert the clean source number string to a Decimal number using BigInt for large numbers
                const decimalValue = BigInt(parseInt(cleanInput, sourceRadix));

                // 2. Convert the Decimal number to the Target Base
                let result = decimalValue.toString(targetRadix);

                // Handle casing for Hexadecimal output
                resultInput.value = targetRadix === 16 ? result.toUpperCase() : result;

                // Show the explain button on success
                explainButton.classList.remove('hidden');
                explainButton.disabled = false;

            } catch (error) {
                // Catches errors like invalid input for the selected source base
                console.error("Conversion Error:", error);
                resultInput.value = `Error: Input "${cleanInput}" is invalid for Base ${sourceRadix}.`;
            }
        }

        /**
         * Converts the current result into an interesting explanation using the Gemini API.
         */
        async function explainNumber() {
            const resultInput = document.getElementById('resultInput');
            const targetBaseSelect = document.getElementById('targetBase');
            const llmResultText = document.getElementById('llmResultText');
            const llmContainer = document.getElementById('llmResultContainer');
            const explainButton = document.getElementById('explainButton');

            const numberValue = resultInput.value;
            const targetBase = targetBaseSelect.options[targetBaseSelect.selectedIndex].text;

            if (!numberValue || numberValue.startsWith('Error') || numberValue.startsWith('Please')) {
                llmResultText.textContent = "Please perform a valid conversion first.";
                llmContainer.classList.remove('hidden');
                return;
            }

            // Set loading state
            explainButton.disabled = true;
            explainButton.innerHTML = '<span class="animate-pulse">✨ Analyzing...</span>';
            llmContainer.classList.remove('hidden');
            llmResultText.innerHTML = '<div class="flex justify-center items-center text-purple-600"><svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Generating fun facts...</div>';

            const userQuery = `Analyze the number "${numberValue}" which is in ${targetBase}. Explain its significance or any interesting facts in computing, mathematics, or history in a friendly, single paragraph.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: "You are a fun, educational computer science tutor. Provide a concise, friendly, and interesting explanation about the significance of the given number. Keep the response to one short paragraph." }]
                }
            };

            const maxRetries = 5;
            let response = null;
            let success = false;

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    response = await fetch(`${apiUrl}?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        success = true;
                        break;
                    } else if (response.status === 429) {
                        // Too Many Requests, implement exponential backoff
                        const delay = Math.pow(2, attempt) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error(`API returned status ${response.status}`);
                    }
                } catch (e) {
                    // console.error("Fetch attempt failed:", e); // Suppress retry logs
                    if (attempt === maxRetries - 1) {
                        break;
                    }
                    const delay = Math.pow(2, attempt) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }

            // Reset button state
            explainButton.textContent = '✨ Explain';
            explainButton.disabled = false;

            if (success && response) {
                try {
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate an explanation right now.";
                    llmResultText.textContent = text;
                } catch (e) {
                    llmResultText.textContent = "Error parsing response from the API.";
                    console.error("Error parsing API response:", e);
                }
            } else {
                llmResultText.textContent = "Failed to connect to the explanation service after several retries.";
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
<!-- Floating Accent in the corner -->
<div class="accent-glow w-10 h-4 rounded-full absolute top-6 right-6 transform rotate-12"></div>

<header class="mb-10 text-center">
    <h1 class="text-4xl font-extrabold text-gray-800 tracking-tight">
        Number System Converter
    </h1>
</header>

<!-- Converter Card -->
<div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800 text-center">
        Enter Number
    </h2>

    <!-- 1. Input Section -->
    <div class="mb-6">
        <input
                id="numberInput"
                type="text"
                placeholder="Enter number (e.g., 255, 10110, or FF)"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition"
                onkeypress="if(event.key === 'Enter') convertNumber()"
        >
    </div>

    <!-- 2. From & 3. To Selection -->
    <div class="flex space-x-4 mb-8">
        <!-- From Target Selection -->
        <div class="flex-1">
            <label for="fromBase" class="block text-lg font-medium text-gray-700 mb-2">
                From
            </label>
            <select
                    id="fromBase"
                    class="w-full p-3 border border-gray-300 bg-white rounded-lg focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition"
            >
                <option value="10" selected>Decimal (Base 10)</option>
                <option value="2">Binary (Base 2)</option>
                <option value="8">Octal (Base 8)</option>
                <option value="16">Hexadecimal (Base 16)</option>
            </select>
        </div>

        <!-- To Target Selection -->
        <div class="flex-1">
            <label for="targetBase" class="block text-lg font-medium text-gray-700 mb-2">
                To
            </label>
            <select
                    id="targetBase"
                    class="w-full p-3 border border-gray-300 bg-white rounded-lg focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition"
            >
                <option value="10">Decimal (Base 10)</option>
                <option value="2">Binary (Base 2)</option>
                <option value="8">Octal (Base 8)</option>
                <option value="16" selected>Hexadecimal (Base 16)</option>
            </select>
        </div>
    </div>

    <!-- 4. Convert Button -->
    <button
            onclick="convertNumber()"
            class="gradient-button w-full text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl text-lg mb-8"
    >
        Convert
    </button>

    <!-- 5. Result Section -->
    <div class="mb-4">
        <label for="resultInput" class="block text-lg font-semibold text-gray-800 mb-2">
            Result
        </label>
        <div class="flex space-x-2">
            <input
                    id="resultInput"
                    type="text"
                    readonly
                    placeholder="Conversion Result"
                    class="flex-grow p-3 border border-gray-200 bg-gray-50 rounded-lg text-gray-700 font-mono select-all cursor-text"
            >
            <button
                    id="explainButton"
                    onclick="explainNumber()"
                    title="Get a fun explanation from Gemini"
                    class="bg-purple-600 text-white font-bold p-3 rounded-xl shadow-md hover:bg-purple-700 transition hidden disabled:opacity-50"
            >
                ✨ Explain
            </button>
        </div>
    </div>

    <!-- Gemini LLM Explanation Container -->
    <div id="llmResultContainer" class="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-xl hidden">
        <p id="llmResultText" class="text-sm text-gray-700 leading-relaxed"></p>
    </div>
</div>
</body>
</html>
